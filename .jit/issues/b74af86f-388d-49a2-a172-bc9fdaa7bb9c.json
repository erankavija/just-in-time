{
  "id": "b74af86f-388d-49a2-a172-bc9fdaa7bb9c",
  "title": "Story: Claim Coordination System",
  "description": "Implement the lease-based claim coordination system that enables safe concurrent access to issues across multiple agents and worktrees.\n\n## Goal\n\nProvide atomic, race-free claim acquisition with time-bounded leases, ensuring only one agent can structurally edit an issue at a time.\n\n## Tasks\n\n1. **Claims JSONL log** - Append-only audit log for all claim operations\n2. **Claims index** - Derived JSON view of active leases, rebuildable from log\n3. **Atomic claim acquisition** - File locking via `fs4` crate with proper atomicity\n4. **Lease operations** - Acquire, renew, release, force-evict with TTL semantics\n5. **Automatic expiration** - Lazy eviction of expired leases during operations\n6. **Heartbeat mechanism** - Optional background renewal for long-running work\n\n## Success Criteria\n\n- Only one active lease per issue (critical invariant)\n- Concurrent claim attempts correctly serialize (exactly one succeeds)\n- Expired leases automatically evicted\n- Monotonic clock used for TTL checks (immune to NTP adjustments)\n- Audit log enables full reconstruction of lease history\n- Sequence numbers provide total ordering\n\n## References\n\nSee design document `dev/design/worktree-parallel-work.md`:\n- Section \"Lease Semantics\" for model and invariants\n- Section \"Atomic Operations and Locking\" for acquisition algorithm\n- Section \"Schema Definitions\" for JSONL and index formats\n- Section \"Atomicity and Durability\" for fsync requirements\n\n## Testing Strategy\n\n- Property-based tests for index consistency\n- Concurrent claim acquisition tests (10+ threads)\n- Lease expiration and eviction tests\n- Monotonic time semantics validation",
  "state": "backlog",
  "priority": "high",
  "assignee": null,
  "dependencies": [
    "581f8345-06a6-4cac-bbd0-9e96bfb74c06",
    "1a5e737d-4262-4de4-a83b-1f0ff26b8064",
    "e66da7c0-150a-4eb5-8f60-faec3449a32f",
    "b31a81be-94c6-4887-84b5-bc8f8864870d",
    "5bc0eff5-9551-49d0-863d-64dc2c2f13ab",
    "1a4c1f79-d350-4d27-827b-8f054f7d9dfb"
  ],
  "gates_required": [
    "tdd-reminder",
    "tests",
    "clippy",
    "fmt",
    "code-review"
  ],
  "gates_status": {},
  "context": {},
  "documents": [
    {
      "path": "dev/design/worktree-parallel-work.md",
      "commit": null,
      "label": "Design Document",
      "doc_type": "design",
      "format": "markdown",
      "assets": [
        {
          "original_path": "https://docs.rs/fs4/",
          "resolved_path": null,
          "asset_type": "external",
          "mime_type": null,
          "content_hash": null,
          "is_shared": false
        },
        {
          "original_path": "https://git-scm.com/docs/git-worktree",
          "resolved_path": null,
          "asset_type": "external",
          "mime_type": null,
          "content_hash": null,
          "is_shared": false
        },
        {
          "original_path": "https://automerge.org/",
          "resolved_path": null,
          "asset_type": "external",
          "mime_type": null,
          "content_hash": null,
          "is_shared": false
        },
        {
          "original_path": "https://github.com/ulid/spec",
          "resolved_path": null,
          "asset_type": "external",
          "mime_type": null,
          "content_hash": null,
          "is_shared": false
        }
      ]
    },
    {
      "path": "dev/sessions/session-claim-coordination-parallel.md",
      "commit": null,
      "label": "Parallel Work Session Notes",
      "doc_type": "notes",
      "format": "markdown"
    },
    {
      "path": "dev/sessions/session-claim-coordination-review.md",
      "commit": null,
      "label": "Implementation Review & Testing Gap Analysis",
      "doc_type": "notes",
      "format": "markdown"
    }
  ],
  "labels": [
    "type:story",
    "epic:parallel-work",
    "milestone:v1.0",
    "component:storage"
  ]
}