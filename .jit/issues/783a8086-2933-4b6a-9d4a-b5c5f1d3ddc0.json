{
  "id": "783a8086-2933-4b6a-9d4a-b5c5f1d3ddc0",
  "title": "Phase 1: Subgraph clustering infrastructure",
  "description": "Implement core data structures and algorithms for hierarchy-aware subgraph clustering with collapsible containers.\n\n## Scope\n\nBuild the foundational infrastructure for clustering lower-level issues into visual subgraphs under higher-level container nodes (epics/milestones), with edge aggregation for collapsed nodes.\n\n**Key deliverables:**\n1. Hierarchy level mapping from config.toml\n2. Subgraph assignment algorithm (follow deps, respect hierarchy boundaries)\n3. Edge aggregation for collapsed containers\n4. TypeScript types for clusters, expansion state, virtual edges\n\n## Approach\n\n**Hierarchy-agnostic design:**\n- Read `type_hierarchy.types` from config (e.g., `{milestone: 1, epic: 2, story: 3, task: 4}`)\n- Level numbers define structure (lower = more strategic)\n- No hardcoded type names\n\n**Subgraph membership:**\n- Each Level 1 node (epic) becomes a container\n- Follow dependencies downward (to higher level numbers)\n- Stop at hierarchy boundaries (don't cross to same/lower level)\n- Cross-level edges preserved but don't pull nodes into subgraph\n\n**Edge aggregation:**\n- When container collapses, bubble up all child edges\n- Story (collapsed) inherits task dependencies\n- Preserve information (show aggregated edge counts)\n\n## TDD Implementation Steps\n\n1. **Hierarchy derivation** (reuse/adapt existing hierarchyIndex.ts)\n   - Tests: various config.toml structures\n   - Function: `getNodeLevel(node, hierarchy)` → number\n\n2. **Subgraph assignment algorithm**\n   - Tests: simple tree, cross-cluster deps, multiple epics\n   - Function: `assignNodesToSubgraphs(nodes, edges, hierarchy)` → Map<clusterId, SubgraphCluster>\n\n3. **Edge aggregation for collapsed nodes**\n   - Tests: single collapse, nested collapse, cross-cluster edges\n   - Function: `aggregateEdgesForCollapsed(cluster, expansionState)` → VirtualEdge[]\n\n## Success Criteria\n\n- [ ] All tests passing (unit tests for each algorithm)\n- [ ] Works with any hierarchy config (not hardcoded)\n- [ ] Correctly assigns Epic ad601a15's 37 nodes to single cluster\n- [ ] Cross-epic task dependencies preserved\n- [ ] Edge aggregation produces correct virtual edges\n\n## Related Documents\n\n- dev/design/subgraph-clustering-layout.md - Full implementation plan",
  "state": "done",
  "priority": "normal",
  "assignee": "agent:copilot-session",
  "dependencies": [],
  "gates_required": [
    "tdd-reminder",
    "code-review"
  ],
  "gates_status": {
    "tdd-reminder": {
      "status": "passed",
      "updated_by": "agent:copilot-session",
      "updated_at": "2026-02-04T17:51:01.770336500Z"
    },
    "code-review": {
      "status": "passed",
      "updated_by": "agent:copilot-session",
      "updated_at": "2026-02-06T19:40:29.277492785Z"
    }
  },
  "context": {},
  "documents": [],
  "labels": [
    "epic:production-polish",
    "component:web",
    "type:task"
  ]
}