{
  "id": "ad601a15-5217-439f-9b3c-94a52c06c18b",
  "title": "Enable parallel multi-agent work with git worktrees",
  "description": "Implement worktree-aware storage and claim coordination to enable multiple agents to work on different issues simultaneously on the same machine without conflicts.\n\n## Problem\nCurrent `.jit/` directory is shared, causing file conflicts when multiple agents work in parallel. Need isolated per-worktree state with shared coordination layer.\n\n## Solution Architecture\n\n### Two-Tier Storage Model\n- **Per-worktree data plane** (`<worktree>/.jit/`): Issue data, local gates, local events\n- **Shared control plane** (`.git/jit/`): Claims registry, locks, heartbeats, control events\n\n### Identity System\n- **Agent ID**: Stable identifier (e.g., `agent:copilot-1`)\n- **Worktree ID**: Deterministic per-worktree identifier (e.g., `wt:abc123`)\n- **Lease ID**: ULID for each claim operation\n\n### Claim/Lease Semantics\n- Time-bounded leases with TTL (default 600s)\n- Heartbeat mechanism for lease renewal\n- Automatic expiration and eviction\n- Single-writer policy per issue\n- Append-only audit log with derived index\n\n## Implementation Checklist\n\n### Phase 1: Foundation\n- [ ] Worktree path detection and resolution\n- [ ] Worktree identity assignment and persistence\n- [ ] Directory layout migration (`.git/jit/` control plane)\n- [ ] Agent identity configuration\n\n### Phase 2: Claim Coordination\n- [ ] Claims JSONL append-only log\n- [ ] Claims index (derived view with active leases)\n- [ ] Atomic claim acquisition with file locking\n- [ ] Lease renewal and release operations\n- [ ] Automatic expiration and eviction\n- [ ] Heartbeat mechanism\n\n### Phase 3: Enforcement\n- [ ] Pre-commit hook for structural edit validation\n- [ ] Pre-commit hook for global operation gating\n- [ ] Branch divergence detection\n- [ ] Lease requirement checks\n\n### Phase 4: CLI Surface\n- [ ] `jit claim acquire <issue> --ttl <secs>`\n- [ ] `jit claim renew <lease-id> --ttl <secs>`\n- [ ] `jit claim release <lease-id>`\n- [ ] `jit claim status [--json]`\n- [ ] `jit worktree info` (show current worktree context)\n\n### Phase 5: Recovery & Robustness\n- [ ] Crash recovery (stale lease cleanup)\n- [ ] Claims index rebuild from JSONL\n- [ ] Lock file cleanup (PID-based or TTL)\n- [ ] Consistency validators\n\n### Phase 6: Documentation\n- [ ] Parallel work tutorial\n- [ ] Worktree setup guide\n- [ ] Claim coordination reference\n- [ ] Troubleshooting guide\n\n## Schema Definitions\n\nSee attached design document for:\n- Claims JSONL schema\n- Claims index JSON schema\n- Worktree identity file schema\n- Heartbeat file schema\n- Pre-commit hook template\n\n## Security Considerations\n- Use 0700 permissions for `.git/jit/` directories\n- Single-user isolation (multi-user requires group permissions)\n- Audit trail in append-only log\n\n## Testing Strategy\n- Property-based tests for claim coordination\n- Concurrent claim acquisition tests\n- Lease expiration and eviction tests\n- Recovery from crash scenarios\n- Hook enforcement validation",
  "state": "backlog",
  "priority": "high",
  "assignee": null,
  "dependencies": [
    "7051d24e-c804-4231-9a60-d1046ef45dde",
    "909c78cc-d5da-4d4c-bfb8-7e9510795bfe"
  ],
  "gates_required": [],
  "gates_status": {},
  "context": {},
  "documents": [
    {
      "path": "dev/design/worktree-parallel-work.md",
      "commit": null,
      "label": "Design Document",
      "doc_type": null
    }
  ],
  "labels": [
    "type:epic",
    "area:storage",
    "area:coordination",
    "milestone:v1.0"
  ]
}