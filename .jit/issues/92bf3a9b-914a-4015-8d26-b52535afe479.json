{
  "id": "92bf3a9b-914a-4015-8d26-b52535afe479",
  "title": "Story: Recovery and Robustness",
  "description": "Implement crash recovery, consistency validation, and self-healing mechanisms to ensure the system recovers gracefully from failures.\n\n## Goal\n\nEnsure the parallel work system is robust against crashes, stale state, and corruption, with automatic recovery where possible.\n\n## Tasks\n\n1. **Startup recovery routine** - Run on every `jit` command to detect/fix issues\n2. **Stale lock cleanup** - Detect and remove locks from dead processes (PID check)\n3. **Claims index rebuild** - Reconstruct index from append-only JSONL log\n4. **Index consistency validation** - Detect duplicates, expired entries, corruption\n5. **Lock hygiene** - Metadata files with PID/timestamp for diagnostics\n6. **Temp file cleanup** - Remove orphaned `.tmp` files from interrupted operations\n\n## Success Criteria\n\n- Corrupted index automatically rebuilt from log without data loss\n- Stale locks from crashed processes cleaned up automatically\n- Lock metadata enables diagnosis of stuck processes\n- `jit validate` reports all consistency issues with fix suggestions\n- No manual intervention required for common failure scenarios\n\n## References\n\nSee design document `dev/design/worktree-parallel-work.md`:\n- Section \"Recovery and Robustness\" for startup recovery algorithm\n- Section \"Lock Hygiene and Metadata\" for lock management\n- Section \"Index Consistency Validation\" for validation logic\n\n## Testing Strategy\n\n- Crash recovery tests (corrupt index, remove mid-operation)\n- Lock cleanup tests (stale locks with dead PIDs)\n- Property-based tests for index rebuild correctness\n\n## Dependencies\n\nRequires Story: Claim Coordination System (structures to recover)",
  "state": "backlog",
  "priority": "high",
  "assignee": null,
  "dependencies": [
    "5f567491-ff8d-4f85-8788-7c4d60ea7a87",
    "e8f9a2ff-e921-439d-9a9e-0710218368ff",
    "d728c8db-f966-4636-948a-9b1c34036fed",
    "fe91699f-7c1a-430b-bcb9-c6f80202c124"
  ],
  "gates_required": [
    "tdd-reminder",
    "tests",
    "clippy",
    "fmt",
    "code-review"
  ],
  "gates_status": {},
  "context": {},
  "documents": [
    {
      "path": "dev/design/worktree-parallel-work.md",
      "commit": null,
      "label": "Design Document",
      "doc_type": "design",
      "format": "markdown",
      "assets": [
        {
          "original_path": "https://docs.rs/fs4/",
          "resolved_path": null,
          "asset_type": "external",
          "mime_type": null,
          "content_hash": null,
          "is_shared": false
        },
        {
          "original_path": "https://github.com/ulid/spec",
          "resolved_path": null,
          "asset_type": "external",
          "mime_type": null,
          "content_hash": null,
          "is_shared": false
        },
        {
          "original_path": "https://git-scm.com/docs/git-worktree",
          "resolved_path": null,
          "asset_type": "external",
          "mime_type": null,
          "content_hash": null,
          "is_shared": false
        },
        {
          "original_path": "https://automerge.org/",
          "resolved_path": null,
          "asset_type": "external",
          "mime_type": null,
          "content_hash": null,
          "is_shared": false
        }
      ]
    }
  ],
  "labels": [
    "type:story",
    "epic:parallel-work",
    "milestone:v1.0",
    "component:storage"
  ]
}