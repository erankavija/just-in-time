{
  "id": "896ff7df-e5b0-48b6-a3b0-a5745ff683b7",
  "title": "Implement jit doc archive with assets",
  "description": "Implement safe document archival that moves docs with per-doc assets and validates link integrity.\n\n## Rationale\n\nCore archival operation that must preserve link integrity. This is the payoff for asset management - safely archive docs without breaking anything.\n\n## IMPORTANT: Updated Directory Structure\n\n**Archive destination is `dev/archive/` NOT `.jit/docs/archive/`** (updated in Phase 0)\n\nSee attached implementation guide for complete details: `dev/active/doc-archive-implementation-guide.md`\n\n## Acceptance Criteria\n\n### 1. Implement jit doc archive\n\nCommand: jit doc archive PATH --type CATEGORY [--dry-run] [--force]\n\nFunctionality:\n- Compute destination in dev/archive/<category>/\n- Validate link integrity before move (uses check-links)\n- Move document and per-doc assets atomically\n- Update issue metadata with new path\n- Log document_archived event\n\nValidation logic:\n- Per-doc assets: OK to move (relative links preserved)\n- Shared assets with root-relative links: OK  \n- Shared assets with relative links: FAIL\n- Linked to active issue: Refuse unless --force\n- Only archives development docs (dev/active, dev/studies, dev/sessions)\n- Refuses to archive permanent docs (docs/, dev/architecture/)\n\n### 2. Archival Process\n\n1. Load configuration from .jit/config.toml\n2. Validate category is configured in [documentation.categories]\n3. Resolve document format and scan assets\n4. Classify assets (per-doc vs shared)\n5. Compute destination path: dev/archive/<category>/<doc>\n6. Validate links won't break (run check-links)\n7. Check for active issue links (warn/fail unless --force)\n8. Preview move plan (if --dry-run)\n9. Execute atomically (temp dir + rename pattern)\n10. Update issue metadata references\n11. Verify links still work post-move\n12. Log event\n\n### 3. Parameters\n\n- PATH: Document to archive (repo-relative)\n- --type CATEGORY: Archive category from config (required)\n  - Must match [documentation.categories] key\n  - Examples: features, bug-fixes, studies, sessions\n  - Domain-agnostic: configurable per project\n- --dry-run: Show plan without executing\n- --force: Override active issue check\n\n### 4. Domain-Agnostic Design\n\nArchive categories are configurable in .jit/config.toml to support any domain:\n\nSoftware (current JIT):\n- categories.design = \"features\"\n- categories.analysis = \"bug-fixes\"\n\nResearch:\n- categories.experiment = \"experiments\"\n- categories.analysis = \"analyses\"\n\nKnowledge work:\n- categories.project = \"completed-projects\"\n- categories.review = \"quarterly-reviews\"\n\n### 5. Atomic Operation\n\nUse temp directory + atomic rename pattern for safety.\nAll-or-nothing file moves with rollback on error.\n\nImplementation:\n1. Create temp directory\n2. Copy all files to temp\n3. Verify copies successful\n4. Move from temp to destination (atomic renames)\n5. On error: rollback (delete destinations)\n6. Delete sources only after verification\n\n### 6. Integration Tests\n\n- Archive doc with per-doc assets \u2192 success\n- Archive doc with root-relative shared assets \u2192 success\n- Archive doc with relative shared links \u2192 failure\n- Archive doc linked to active issue \u2192 failure (unless --force)\n- Archive permanent doc (docs/) \u2192 failure\n- Dry-run doesn't mutate\n- Rollback on error\n- Issue metadata updated correctly\n- jit doc show still works after archival\n\n### 7. Documentation\n\n- Help text consistent with other doc commands\n- Implementation guide attached (comprehensive reference)\n- Examples for different domains\n\n## Dependencies\n\n- Task 10: jit doc check-links \u2705 DONE\n\n## Out of Scope (Phase 2)\n\n- Link rewriting implementation\n- Batch archival (see jit doc sweep)\n- Automated archival based on retention policy\n\n## Success Metrics\n\n- Safe archival with link preservation\n- Atomic operations (no partial moves)\n- Clear validation and error messages\n- Domain-agnostic category support\n- Tests cover success and failure paths\n- Configuration-driven categories",
  "state": "done",
  "priority": "high",
  "assignee": "copilot:session-1",
  "dependencies": [
    "fb6e2e31-a3c1-458b-abf7-cf113a80dd9c"
  ],
  "gates_required": [
    "tdd-reminder",
    "tests",
    "clippy",
    "fmt",
    "code-review"
  ],
  "gates_status": {
    "fmt": {
      "status": "passed",
      "updated_by": "auto:executor",
      "updated_at": "2025-12-27T22:39:49.184289055Z"
    },
    "clippy": {
      "status": "passed",
      "updated_by": "auto:executor",
      "updated_at": "2025-12-27T22:39:45.825768951Z"
    },
    "tdd-reminder": {
      "status": "passed",
      "updated_by": "copilot:session-1",
      "updated_at": "2025-12-24T22:39:18.894407641Z"
    },
    "code-review": {
      "status": "passed",
      "updated_by": null,
      "updated_at": "2025-12-27T22:39:50.005676242Z"
    },
    "tests": {
      "status": "passed",
      "updated_by": "auto:executor",
      "updated_at": "2025-12-27T22:39:41.398438063Z"
    }
  },
  "context": {},
  "documents": [
    {
      "path": "dev/active/doc-archive-implementation-guide.md",
      "commit": null,
      "label": "Implementation Guide",
      "doc_type": "design"
    },
    {
      "path": "dev/sessions/session-2025-12-27-doc-archive.md",
      "commit": null,
      "label": "Session notes",
      "doc_type": null,
      "format": "markdown"
    }
  ],
  "labels": [
    "type:task",
    "epic:docs-lifecycle",
    "milestone:v1.0",
    "component:cli",
    "component:core"
  ],
  "created_at": "2025-12-24T22:39:18.904658223Z",
  "updated_at": "2025-12-24T22:33:02.253649213Z"
}
