{
  "id": "8898b638-b5fe-4982-9d5f-8935dd5f793c",
  "title": "jit init should regenerate worktree.json in new worktrees",
  "description": "## Problem\n\nWhen creating a new git worktree with `git worktree add`, git copies the entire directory structure including `.jit/worktree.json`. This causes duplicate worktree IDs.\n\n**Current behavior (before fix):**\n```bash\n# In main worktree\ngit worktree add ../feature -b feature/my-work\ncd ../feature\njit init\njit worktree list\n# Shows both worktrees with SAME worktree ID (wt:abc12345)\n```\n\n**Why it happens:**\n1. `git worktree add` copies `.jit/worktree.json` from source worktree\n2. The copied file contains the source worktree's root path\n3. `jit init` doesn't check or remove this copied file\n4. When jit commands run, `load_or_create_worktree_identity` sees the file exists and treats it as a \"relocation\", preserving the same ID\n\n## Solution\n\nModified `load_or_create_worktree_identity()` to intelligently distinguish between:\n1. **Copied file** (from `git worktree add`) \u2192 delete and regenerate with unique ID\n2. **Genuine relocation** (directory moved) \u2192 update path, preserve ID\n\n**Detection algorithm:** When a secondary worktree has a path mismatch:\n- Check if the old path still exists with the same worktree ID\n- If **yes**: this is a copy from `git worktree add` \u2192 regenerate ID\n- If **no**: this is a move (e.g., `git worktree move`) \u2192 update path, preserve ID\n\nAlso updated `jit init` to:\n- Always create `worktree.json` in git repositories (was lazy before)\n- Only create in actual git repos (not non-git directories)\n- Display worktree ID in success message\n\n## Worktree Relocation Support\n\n**Main worktrees:** Full relocation support - ID is preserved when directory is moved\n\n**Secondary worktrees:** \n- \u2705 `git worktree move` preserves worktree ID correctly\n- \u26a0\ufe0f Manual directory moves (e.g., `mv worktree new-location`) will generate new ID\n\nThis aligns with git's philosophy - use `git worktree move` for proper tracking updates.\n\n## Acceptance Criteria\n\n- [x] `jit init` in a new worktree generates unique worktree ID\n- [x] `jit init` called again in same worktree preserves existing ID (idempotent)\n- [x] `jit worktree list` shows distinct IDs for each worktree\n- [x] Main worktree behavior unchanged (relocation still supported)\n- [x] `git worktree move` preserves worktree ID in secondary worktrees\n- [x] Tests verify all scenarios",
  "state": "done",
  "priority": "normal",
  "assignee": "agent:copilot-session",
  "dependencies": [],
  "gates_required": [],
  "gates_status": {},
  "context": {},
  "documents": [],
  "labels": [
    "type:bug",
    "component:core",
    "epic:production-polish"
  ],
  "created_at": "2026-02-13T00:23:36.658214+02:00",
  "updated_at": "2026-02-12T21:48:16.731273326Z"
}
